/*!
 * color-tiles-remake - Remake of GameSaien's Color Tiles
 * @version v0.1.2
 * @date Sun, 30 Mar 2014 13:23:46 GMT
 * @link https://execjosh.github.io/color-tiles-remake/build/
 * @license ISC
 */
(function(){var t,s,i,e,h,o,r,n,l,a,u,_,c,p,f,d,w,m,x,y=function(t,s){return function(){return t.apply(s,arguments)}};w="null",d="init",m="ready",f="game",p="end",e=["#06F","#F8F","#C6C","#6CC","#BBB","#CC6","#F90","#0C0","#C60","#F66"],r=60,o=.001,n=120,h=10,_=20,a=20,u=20,l=35,i=25,s=23,t=15,c=3,x=function(){return console.log.apply(console,arguments)},this.Application=function(){function r(){this.onTick=y(this.onTick,this),this._version="0.1.2",this._state=w,this._ctx=null,this._w=1,this._h=1,this._screens={},this._clicked=!1,this._lastTime=0,this._timeAccumulator=0,this._mouseX=0,this._mouseY=0,this._clickX=0,this._clickY=0,this._mouseAlpha=1,this._lastIX=0,this._lastIY=0,this._board=[],this._countDown=0,this._score=0,this._gameEnd=0,this._spriteList=[]}return r.prototype.init=function(t){var s,i;return this._state!==w?!1:(this.setState(d),s=$("#"+t),null==s?!1:(s.mousedown(function(t){return function(s){var i,e;return i=s.offsetX,e=s.offsetY,t.onClick(i,e)}}(this)).mousemove(function(t){return function(s){var i,e;return i=s.offsetX,e=s.offsetY,t.onMouseMove(i,e)}}(this)),i=s.get(0),this._ctx=i.getContext("2d"),this._w=parseInt(i.width,10),this._h=parseInt(i.height,10),this.setState(m),!0))},r.prototype.getSprite=function(t,s,e){var h,o,r,n;return r=a+i+t*i,n=_+i+s*i,h=600*Math.random()-300,o=-500,new Sprite(r,n,h,o,e)},r.prototype.generateBoard=function(){var i,h,o,r,n,l,a,u,_;for(o=l=0;t>=0?t>l:l>t;o=t>=0?++l:--l)n=function(){var t,i;for(i=[],h=t=0;s>=0?s>t:t>s;h=s>=0?++t:--t)i.push(null);return i}(),this._board[o]=n;for(a=0,_=e.length;_>a;a++)for(i=e[a],r=u=0;20>u;r=++u){for(;;)if(h=Math.floor(Math.random()*s),o=Math.floor(Math.random()*t),null==this._board[o][h])break;this._board[o][h]=this.getSprite(h,o,i)}},r.prototype.onClick=function(t,s){this._clickX=t,this._clickY=s,this._clicked=!0},r.prototype.onMouseMove=function(t,s){var i,e;this._mouseX=t,this._mouseY=s,i=this.x2index(this._mouseX),e=this.y2index(this._mouseY),(this._lastIX!==i||this._lastIY!==e)&&(this._mouseAlpha=1),this._lastIX=i,this._lastIY=e},r.prototype.onTick=function(t){var s;for(s=.001*(t-this._lastTime),s>.25&&(s=.25),this._lastTime=t,this.updateInput(),this._timeAccumulator+=s;this._timeAccumulator>=o;)this.updateGame(o),this._timeAccumulator-=o;this.updateGrafix(),requestAnimationFrame(this.onTick)},r.prototype.setState=function(t){var s;switch(s=""+this._state+":"+t,this._state=t,s){case""+d+":"+m:this.generateBoard(),this._lastTime=performance.now(),requestAnimationFrame(this.onTick);break;case""+m+":"+f:this.generateBoard(),this._countDown=n,this._score=0,this._spriteList=[];break;case""+f+":"+p:this._gameEnd=performance.now(),this._spriteList=[];break;case""+p+":"+m:this.generateBoard()}},r.prototype.x2index=function(t){return Math.floor((t-a)/i)-1},r.prototype.y2index=function(t){return Math.floor((t-_)/i)-1},r.prototype.checkHit=function(t,s){return null!=t&&null!=s&&t._color===s._color},r.prototype.updateInput=function(){var e,o,r,n,c,d,w,x,y,k,b,g;if(this._clicked){switch(this._state){case m:this.setState(f);break;case f:if(a+i<=(b=this._clickX)&&b<this._w-u-i&&_+i<=(g=this._clickY)&&g<this._h-l-i&&(c=this.x2index(this._clickX),d=this.y2index(this._clickY),null==this._board[d][c])){for(e={west:null,east:null,north:null,south:null},k=c-1,r=c+1,w=d-1,y=d+1;k>=0||s>r||w>=0||t>y;)null==e.west&&k>=0&&null!=this._board[d][k]&&(e.west={sprite:this._board[d][k],ix:k,iy:d}),null==e.east&&s>r&&null!=this._board[d][r]&&(e.east={sprite:this._board[d][r],ix:r,iy:d}),null==e.north&&w>=0&&null!=this._board[w][c]&&(e.north={sprite:this._board[w][c],ix:c,iy:w}),null==e.south&&t>y&&null!=this._board[y][c]&&(e.south={sprite:this._board[y][c],ix:c,iy:y}),k--,r++,w--,y++;n={west:null,east:null,north:null,south:null},null!=e.west&&null!=e.north&&this.checkHit(e.west.sprite,e.north.sprite)&&(n.west=e.west,n.north=e.north),null!=e.west&&null!=e.east&&this.checkHit(e.west.sprite,e.east.sprite)&&(n.west=e.west,n.east=e.east),null!=e.west&&null!=e.south&&this.checkHit(e.west.sprite,e.south.sprite)&&(n.west=e.west,n.south=e.south),null!=e.north&&null!=e.south&&this.checkHit(e.north.sprite,e.south.sprite)&&(n.north=e.north,n.south=e.south),null!=e.north&&null!=e.east&&this.checkHit(e.north.sprite,e.east.sprite)&&(n.north=e.north,n.east=e.east),null!=e.south&&null!=e.east&&this.checkHit(e.south.sprite,e.east.sprite)&&(n.south=e.south,n.east=e.east),null==n.west&&null==n.east&&null==n.north&&null==n.south?this._countDown-=h:(null!=n.west&&(this._score++,this._board[n.west.iy][n.west.ix]=null,this._spriteList.push(n.west.sprite)),null!=n.east&&(this._score++,this._board[n.east.iy][n.east.ix]=null,this._spriteList.push(n.east.sprite)),null!=n.north&&(this._score++,this._board[n.north.iy][n.north.ix]=null,this._spriteList.push(n.north.sprite)),null!=n.south&&(this._score++,this._board[n.south.iy][n.south.ix]=null,this._spriteList.push(n.south.sprite)))}break;case p:x=performance.now(),o=.001*(x-this._gameEnd),o>1&&this.setState(m)}this._clicked=!1}},r.prototype.updateGame=function(t){var s,e,h,o,r;if(this._state===f)for(this._countDown-=t,this._mouseAlpha=Math.max(0,this._mouseAlpha-c*t),0>=this._countDown&&this.setState(p),r=this._spriteList,s=h=0,o=r.length;o>h;s=++h)e=r[s],null!=e&&(e.update(t),(e._x<-i||e._x>=this._w||e._y>=this._h)&&this._spriteList.splice(s,1))},r.prototype.updateGrafix=function(){var t,s,e,h,o,r,n,c;if(this._state!==w){for(e=this._ctx,e.clearRect(0,0,this._w,this._h),e.lineWidth=1,t=0,s=0,h=10,this.roundRect(t,s,this._w-2*t,this._h-2*s,h),e.strokeStyle="#888",e.stroke(),e.beginPath(),e.moveTo(a,_),e.lineTo(this._w-u,_),e.lineTo(this._w-u,this._h-l),e.lineTo(a,this._h-l),e.closePath(),e.strokeStyle="#333",e.stroke(),e.font="9px sans-serif",e.textAlign="left",e.fillStyle="#AAA",e.fillText("v"+this._version,a,this._h-l+17),r=[["#F7F7F7","#EDEDED"],["#EDEDED","#F7F7F7"]],c=_;c<this._h-_-l;){for(o=r[(c-_)/i%2],n=a;n<this._w-a-u;)e.fillStyle=o[(n-a)/i%2],e.fillRect(n,c,i,i),n+=i;c+=i}switch(this._state){case d:break;case m:this.renderGame(e),e.font="bold 30px sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillStyle="#000",e.fillText("Color Tile",.5*this._w,.5*this._h-30),e.fillText("Click to Start",.5*this._w,.5*this._h+30);break;case f:this.renderGame(e);break;case p:this.renderGame(e),e.font="bold 30px sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillStyle="#000",e.fillText("SCORE: "+this._score,.5*this._w,.5*this._h-20),e.fillText("Click to Continue",.5*this._w,.5*this._h+20)}}},r.prototype.renderGame=function(e){var h,o,r,c,p,d,w,m,x,y,k,b,g,v,S,A;for(this._state===f&&(a+i<=(g=this._mouseX)&&g<this._w-u-i&&_+i<=(v=this._mouseY)&&v<this._h-l-i&&(o=this.x2index(this._mouseX),r=this.y2index(this._mouseY),null==this._board[r][o]&&this._mouseAlpha>0&&(w=a+i+o*i,m=_+i+r*i,e.fillStyle="rgba(204,204,204,"+this._mouseAlpha+")",e.fillRect(w+1,m+1,i-2,i-2))),d=12*i,h=10,c=1-(n-this._countDown)/n,w=a+.5*i-.5*h,m=_+.5*i-.5*h,e.fillStyle=.35>=c?.15>=c?"#F33":"#F80":"#8F8",e.strokeStyle="#777",e.lineWidth=1,e.strokeRect(w,m,d,h),e.fillRect(w+1,m+1,(d-2)*c,h-2)),e.shadowOffsetX=1,e.shadowOffsetY=1,e.shadowBlur=2,e.shadowColor="rgba(0, 0, 0, 0.5)",r=x=0;t>=0?t>x:x>t;r=t>=0?++x:--x)for(o=y=0;s>=0?s>y:y>s;o=s>=0?++y:--y)null!=(S=this._board[r][o])&&S.render(e);for(e.shadowOffsetX=3,e.shadowOffsetY=3,e.shadowBlur=5,A=this._spriteList,k=0,b=A.length;b>k;k++)p=A[k],p.render(e);e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0},r.prototype.roundRect=function(t,s,i,e,h){var o,r;o=t+h,r=s+h,this._ctx.beginPath(),this._ctx.arc(o,r,h,Math.PI,1.5*Math.PI,!1),this._ctx.arc(t+i-h,r,h,1.5*Math.PI,0,!1),this._ctx.arc(t+i-h,s+e-h,h,0,.5*Math.PI,!1),this._ctx.arc(o,s+e-h,h,.5*Math.PI,Math.PI,!1),this._ctx.closePath()},r}()}).call(this),function(){var t;t=25,this.Sprite=function(){function s(t,s,i,e,h){this._x=t,this._y=s,this._dx=i,this._dy=e,this._color=h}return s.prototype.render=function(s){return s.fillStyle=this._color,s.fillRect(this._x+1,this._y+1,t-2,t-2)},s.prototype.update=function(t){return this._dy+=3600*t,this._x+=this._dx*t,this._y+=this._dy*t},s}()}.call(this);
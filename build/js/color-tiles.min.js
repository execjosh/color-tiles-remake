/*!
 * color-tiles-remake - Remake of GameSaien's Color Tiles
 * @version v0.1.0
 * @date Fri, 28 Mar 2014 16:12:44 GMT
 * @link https://execjosh.github.io/color-tiles-remake/build/
 * @license ISC
 */
(function(){var t,s,i,e,h,o,n,r,l,a,u,c,_,f,p,d,w,x;d="null",p="init",w="ready",f="game",_="end",e=["#06F","#F8F","#C6C","#6CC","#BBB","#CC6","#F90","#0C0","#C60","#F66"],n=60,o=.001,r=120,h=10,c=20,a=20,u=20,l=35,i=25,s=23,t=15,x=function(){return console.log.apply(console,arguments)},this.Application=function(){function x(){this._version="0.1.0",this._state=d,this._ctx=null,this._w=1,this._h=1,this._screens={},this._clicked=!1,this._lastTime=0,this._timeAccumulator=0,this._mouseX=0,this._mouseY=0,this._clickX=0,this._clickY=0,this._board=[],this._countDown=0,this._score=0,this._gameEnd=0,this._spriteList=[]}return x.prototype.init=function(t){var s,i;return this._state!==d?!1:(this.setState(p),s=$("#"+t),null==s?!1:(s.mousedown(function(t){return function(s){var i,e;return i=s.offsetX,e=s.offsetY,t.onClick(i,e)}}(this)).mousemove(function(t){return function(s){var i,e;return i=s.offsetX,e=s.offsetY,t.onMouseMove(i,e)}}(this)),i=s.get(0),this._ctx=i.getContext("2d"),this._w=parseInt(i.width,10),this._h=parseInt(i.height,10),this.setState(w),!0))},x.prototype.getSprite=function(t,s,e){var h,o,n,r;return n=a+i+t*i,r=c+i+s*i,h=600*Math.random()-300,o=-500,new Sprite(n,r,h,o,e)},x.prototype.generateBoard=function(){var i,h,o,n,r,l,a,u,c;for(o=l=0;t>=0?t>l:l>t;o=t>=0?++l:--l)r=function(){var t,i;for(i=[],h=t=0;s>=0?s>t:t>s;h=s>=0?++t:--t)i.push(null);return i}(),this._board[o]=r;for(a=0,c=e.length;c>a;a++)for(i=e[a],n=u=0;20>u;n=++u){for(;;)if(h=Math.floor(Math.random()*s),o=Math.floor(Math.random()*t),null==this._board[o][h])break;this._board[o][h]=this.getSprite(h,o,i)}},x.prototype.onClick=function(t,s){this._clickX=t,this._clickY=s,this._clicked=!0},x.prototype.onMouseMove=function(t,s){this._mouseX=t,this._mouseY=s},x.prototype.onTick=function(){var t,s;for(s=(new Date).getTime(),t=.001*(s-this._lastTime),t>.25&&(t=.25),this._lastTime=s,this.updateInput(),this._timeAccumulator+=t;this._timeAccumulator>=o;)this.updateGame(o),this._timeAccumulator-=o;this.updateGrafix()},x.prototype.setState=function(t){var s;switch(s=""+this._state+":"+t,this._state=t,s){case""+p+":"+w:this.generateBoard(),this._lastTime=(new Date).getTime(),window.setInterval(function(t){return function(){return t.onTick()}}(this),1e3/n);break;case""+w+":"+f:this.generateBoard(),this._countDown=r,this._score=0,this._spriteList=[];break;case""+f+":"+_:this._gameEnd=(new Date).getTime(),this._spriteList=[];break;case""+_+":"+w:this.generateBoard()}},x.prototype.x2index=function(t){return Math.floor((t-a)/i)-1},x.prototype.y2index=function(t){return Math.floor((t-c)/i)-1},x.prototype.checkHit=function(t,s){return null!=t&&null!=s&&t._color===s._color},x.prototype.updateInput=function(){var e,o,n,r,p,d,x,y,m,k,b,g;if(this._clicked){switch(this._state){case w:this.setState(f);break;case f:if(a+i<=(b=this._clickX)&&b<this._w-u-i&&c+i<=(g=this._clickY)&&g<this._h-l-i&&(p=this.x2index(this._clickX),d=this.y2index(this._clickY),null==this._board[d][p])){for(e={west:null,east:null,north:null,south:null},k=p-1,n=p+1,x=d-1,m=d+1;k>=0||s>n||x>=0||t>m;)null==e.west&&k>=0&&null!=this._board[d][k]&&(e.west={sprite:this._board[d][k],ix:k,iy:d}),null==e.east&&s>n&&null!=this._board[d][n]&&(e.east={sprite:this._board[d][n],ix:n,iy:d}),null==e.north&&x>=0&&null!=this._board[x][p]&&(e.north={sprite:this._board[x][p],ix:p,iy:x}),null==e.south&&t>m&&null!=this._board[m][p]&&(e.south={sprite:this._board[m][p],ix:p,iy:m}),k--,n++,x--,m++;r={west:null,east:null,north:null,south:null},null!=e.west&&null!=e.north&&this.checkHit(e.west.sprite,e.north.sprite)&&(r.west=e.west,r.north=e.north),null!=e.west&&null!=e.east&&this.checkHit(e.west.sprite,e.east.sprite)&&(r.west=e.west,r.east=e.east),null!=e.west&&null!=e.south&&this.checkHit(e.west.sprite,e.south.sprite)&&(r.west=e.west,r.south=e.south),null!=e.north&&null!=e.south&&this.checkHit(e.north.sprite,e.south.sprite)&&(r.north=e.north,r.south=e.south),null!=e.north&&null!=e.east&&this.checkHit(e.north.sprite,e.east.sprite)&&(r.north=e.north,r.east=e.east),null!=e.south&&null!=e.east&&this.checkHit(e.south.sprite,e.east.sprite)&&(r.south=e.south,r.east=e.east),null==r.west&&null==r.east&&null==r.north&&null==r.south?this._countDown-=h:(null!=r.west&&(this._score++,this._board[r.west.iy][r.west.ix]=null,this._spriteList.push(r.west.sprite)),null!=r.east&&(this._score++,this._board[r.east.iy][r.east.ix]=null,this._spriteList.push(r.east.sprite)),null!=r.north&&(this._score++,this._board[r.north.iy][r.north.ix]=null,this._spriteList.push(r.north.sprite)),null!=r.south&&(this._score++,this._board[r.south.iy][r.south.ix]=null,this._spriteList.push(r.south.sprite)))}break;case _:y=(new Date).getTime(),o=.001*(y-this._gameEnd),o>1&&this.setState(w)}this._clicked=!1}},x.prototype.updateGame=function(t){var s,e,h,o,n;if(this._state===f)for(this._countDown-=t,0>=this._countDown&&this.setState(_),n=this._spriteList,s=h=0,o=n.length;o>h;s=++h)e=n[s],null!=e&&(e.update(t),(e._x<-i||e._x>=this._w||e._y>=this._h)&&this._spriteList.splice(s,1))},x.prototype.updateGrafix=function(){var t,s,e,h,o,n,r,x;if(this._state!==d){for(e=this._ctx,e.clearRect(0,0,this._w,this._h),e.lineWidth=1,t=0,s=0,h=10,this.roundRect(t,s,this._w-2*t,this._h-2*s,h),e.strokeStyle="#888",e.stroke(),e.beginPath(),e.moveTo(a,c),e.lineTo(this._w-u,c),e.lineTo(this._w-u,this._h-l),e.lineTo(a,this._h-l),e.closePath(),e.strokeStyle="#333",e.stroke(),e.font="9px sans-serif",e.textAlign="left",e.fillStyle="#AAA",e.fillText("v"+this._version,a,this._h-l+17),n=[["#F7F7F7","#EDEDED"],["#EDEDED","#F7F7F7"]],x=c;x<this._h-c-l;){for(o=n[(x-c)/i%2],r=a;r<this._w-a-u;)e.fillStyle=o[(r-a)/i%2],e.fillRect(r,x,i,i),r+=i;x+=i}switch(this._state){case p:break;case w:this.renderGame(e),e.font="bold 30px sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillStyle="#000",e.fillText("Color Tile",.5*this._w,.5*this._h-30),e.fillText("Click to Start",.5*this._w,.5*this._h+30);break;case f:this.renderGame(e);break;case _:this.renderGame(e),e.font="bold 30px sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillStyle="#000",e.fillText("SCORE: "+this._score,.5*this._w,.5*this._h-20),e.fillText("Click to Continue",.5*this._w,.5*this._h+20)}}},x.prototype.renderGame=function(e){var h,o,n,_,p,d,w,x,y,m,k,b,g,v,S,C;for(this._state===f&&(a+i<=(g=this._mouseX)&&g<this._w-u-i&&c+i<=(v=this._mouseY)&&v<this._h-l-i&&(o=this.x2index(this._mouseX),n=this.y2index(this._mouseY),null==this._board[n][o]&&(w=a+i+o*i,x=c+i+n*i,e.fillStyle="#CCC",e.fillRect(w+1,x+1,i-2,i-2))),d=12*i,h=10,_=1-(r-this._countDown)/r,w=a+.5*i-.5*h,x=c+.5*i-.5*h,e.fillStyle=.35>=_?.15>=_?"#F33":"#F80":"#8F8",e.strokeStyle="#777",e.lineWidth=1,e.strokeRect(w,x,d,h),e.fillRect(w+1,x+1,(d-2)*_,h-2)),e.shadowOffsetX=1,e.shadowOffsetY=1,e.shadowBlur=2,e.shadowColor="rgba(0, 0, 0, 0.5)",n=y=0;t>=0?t>y:y>t;n=t>=0?++y:--y)for(o=m=0;s>=0?s>m:m>s;o=s>=0?++m:--m)null!=(S=this._board[n][o])&&S.render(e);for(e.shadowOffsetX=3,e.shadowOffsetY=3,e.shadowBlur=5,C=this._spriteList,k=0,b=C.length;b>k;k++)p=C[k],p.render(e);e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0},x.prototype.roundRect=function(t,s,i,e,h){var o,n;o=t+h,n=s+h,this._ctx.beginPath(),this._ctx.arc(o,n,h,Math.PI,1.5*Math.PI,!1),this._ctx.arc(t+i-h,n,h,1.5*Math.PI,0,!1),this._ctx.arc(t+i-h,s+e-h,h,0,.5*Math.PI,!1),this._ctx.arc(o,s+e-h,h,.5*Math.PI,Math.PI,!1),this._ctx.closePath()},x}()}).call(this),function(){var t;t=25,this.Sprite=function(){function s(t,s,i,e,h){this._x=t,this._y=s,this._dx=i,this._dy=e,this._color=h}return s.prototype.render=function(s){return s.fillStyle=this._color,s.fillRect(this._x+1,this._y+1,t-2,t-2)},s.prototype.update=function(t){return this._dy+=3600*t,this._x+=this._dx*t,this._y+=this._dy*t},s}()}.call(this);